(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"p0/3":function(t,o,n){"use strict";n.r(o),n.d(o,"AutomatonEditorModule",(function(){return b}));var e=n("vOrQ"),i=n("Yf6g"),a=n("D57K"),s=n("wgwC");const r=Object(s.d)({type:s.c.form,name:"AutomatonEditor",icon:"assets/images/components/forms/automaton-editor/automaton-editor.svg",selector:"wc-automaton-editor",description:"Permets de saisir un automate \xe0 l'aide d'un \xe9diteur graphique.",fullDescriptionUrl:"assets/docs/components/forms/automaton-editor/automaton-editor.md",schema:{$schema:"http://json-schema.org/draft-07/schema",type:"object",properties:{height:{type:"number",default:400,description:"La hauteur de l'\xe9diteur en px."},automaton:{type:"object",default:{},description:"Automate dessiner."}}}});var c=n("A2ki"),d=n("iVbZ"),u=n("6Jna"),h=n("0S4P"),m=n("4cXV");const p=["container"];function l(t,o){if(1&t&&(e["\u0275\u0275elementContainerStart"](0),e["\u0275\u0275elementStart"](1,"button",6),e["\u0275\u0275listener"]("click",(function(){return o.$implicit.run()})),e["\u0275\u0275text"](2),e["\u0275\u0275elementEnd"](),e["\u0275\u0275elementContainerEnd"]()),2&t){const t=o.$implicit;e["\u0275\u0275advance"](2),e["\u0275\u0275textInterpolate1"](" ",t.name," ")}}const g="automaton-state--initial",f="automaton-state--final";let v=(()=>{let t=class{constructor(t,o){this.injector=t,this.dialog=o,this.nextId=0,this.actions=[]}set automaton(t){this.state.automaton=t}get automaton(){return this.state.automaton}ngOnInit(){return Object(a.a)(this,void 0,void 0,(function*(){this.instance=c.jsPlumb.getInstance({Endpoint:["Dot",{radius:2}],Connector:"StateMachine",HoverPaintStyle:{stroke:"#1e8151",strokeWidth:2},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}],["Label",{label:"transition",id:"transition",cssClass:"transition"}]],Container:this.container.nativeElement}),yield new Promise(t=>{this.instance.bind("ready",()=>{this.instance.registerConnectionType("basic",{anchor:"Continuous",connector:"StateMachine"}),this.instance.bind("click",t=>{this.focus(void 0,t)}),this.instance.bind("beforeDrop",t=>{this.createTransition(t)}),c.jsPlumb.on(this.container.nativeElement,"dblclick",t=>{this.createNode(t.offsetX,t.offsetY)}),t()})})}))}ngOnDestroy(){var t;null===(t=this.instance)||void 0===t||t.reset()}onChangeState(){this.node=void 0,this.connection=void 0,this.instance.reset(!0),this.instance.getContainer().innerHTML="";try{"string"==typeof this.automaton?this.automaton=Object(d.a)(this.automaton):this.automaton||(this.automaton=Object(d.c)())}catch(o){console.log(o),this.automaton=Object(d.c)()}this.nextId=this.automaton.states.length;const t=this.automaton;t.position=this.automaton.position||{},t.states=this.automaton.states||[],t.acceptingStates=this.automaton.acceptingStates||[],t.initialStates=this.automaton.initialStates||[],t.transitions=this.automaton.transitions||[],this.updateAlphabet(),this.instance.batch(()=>{t.states.forEach(o=>{t.position||(t.position={});const n=t.position[o];n?this.createNode(n.x,n.y,o):this.createNode(400*Math.random(),200*Math.random(),o)})})}createTransition(t){const{sourceId:o,targetId:n}=t;return!this.automaton.transitions.find(t=>t.fromState===o&&t.toState===n)&&(this.automaton.transitions.push({fromState:o,toState:n,symbols:["$"]}),this.updateAlphabet(),!0)}createNode(t,o,n){var e,i;const a=document.createElement("div"),s=n||"S"+this.nextId++;a.id=s,a.className="automaton-state",a.innerHTML=s+' <div class="endpoint"></div>',a.style.left=t+"px",a.style.top=o+"px",this.automaton.position||(this.automaton.position={}),this.automaton.position[a.id]={x:t,y:o},n?(this.automaton.initialStates.includes(n)&&a.classList.add(g),this.automaton.acceptingStates.includes(n)&&a.classList.add(f)):(0===this.automaton.initialStates.length&&(a.classList.add(g),this.automaton.initialStates.push(s)),this.automaton.states.push(s)),c.jsPlumb.on(a,"click",()=>{this.focus(a)}),null===(e=this.instance)||void 0===e||e.getContainer().appendChild(a),null===(i=this.instance)||void 0===i||i.draggable(a,{drag:t=>{this.automaton.position||(this.automaton.position={}),this.automaton.position[a.id]={x:t.pos[0],y:t.pos[1]}}}),this.instance.makeSource(a,{filter:".endpoint",anchor:"Continuous",connectorStyle:{stroke:"#5c96bc",strokeWidth:2,outlineStroke:"transparent",outlineWidth:4},connectionType:"basic",maxConnections:-1}),this.instance.makeTarget(a,{dropOptions:{hoverClass:"dragHover"},anchor:"Continuous",allowLoopback:!0})}focus(t,o){this.unfocus(),this.node=t,this.connection=o;const n=[];if(this.node){this.node.classList.remove("focused"),this.node.classList.add("focused");const t=this.node.classList.contains(g),o=this.node.classList.contains(f);t||n.push({name:"Initial",run:()=>{this.node&&(this.node.classList.add(g),this.automaton.initialStates.push(this.node.id),this.focus(this.node))}}),o||n.push({name:"Final",run:()=>{this.node&&(this.node.classList.add(f),this.automaton.acceptingStates.includes(this.node.id)||this.automaton.acceptingStates.push(this.node.id),this.focus(this.node))}}),(t||o)&&n.push({name:"Normal",run:()=>{this.node&&(this.node.classList.remove(g),this.node.classList.remove(f),this.automaton.acceptingStates=this.automaton.acceptingStates.filter(t=>{var o;return t!==(null===(o=this.node)||void 0===o?void 0:o.id)}),this.focus(this.node))}}),n.push({name:"Renommer",run:()=>Object(a.a)(this,void 0,void 0,(function*(){if(!this.node)return;let t=yield this.prompt("\xc9tat","Entrez un nouveau nom",this.node.id);!1!==t&&(t=t.trim(),this.automaton.states.includes(t)?alert("\xc9tat d\xe9j\xe0 pr\xe9sent"):(this.automaton.states=[t,...this.automaton.states.filter(t=>{var o;return t!==(null===(o=this.node)||void 0===o?void 0:o.id)})],this.automaton.acceptingStates=this.automaton.acceptingStates.map(o=>{var n;return o===(null===(n=this.node)||void 0===n?void 0:n.id)?t:o}),this.automaton.initialStates=this.automaton.initialStates.map(o=>{var n;return o===(null===(n=this.node)||void 0===n?void 0:n.id)?t:o}),this.automaton.transitions.forEach(o=>{var n,e;o.fromState===(null===(n=this.node)||void 0===n?void 0:n.id)&&(o.fromState=t),o.toState===(null===(e=this.node)||void 0===e?void 0:e.id)&&(o.toState=t)}),this.node.innerHTML=this.node.id=t)),this.updateAlphabet()}))}),n.push({name:"Supprimer",run:()=>{this.automaton.initialStates=this.automaton.initialStates.filter(t=>{var o;return t!==(null===(o=this.node)||void 0===o?void 0:o.id)}),this.automaton.acceptingStates=this.automaton.acceptingStates.filter(t=>{var o;return t!==(null===(o=this.node)||void 0===o?void 0:o.id)}),this.automaton.states=this.automaton.states.filter(t=>{var o;return t!==(null===(o=this.node)||void 0===o?void 0:o.id)}),this.automaton.transitions=this.automaton.transitions.filter(t=>{var o,n;return t.fromState!==(null===(o=this.node)||void 0===o?void 0:o.id)&&t.toState!==(null===(n=this.node)||void 0===n?void 0:n.id)}),this.automaton.position||(this.automaton.position={}),this.node&&(delete this.automaton.position[this.node.id],this.instance.remove(this.node),this.focus(),this.updateAlphabet())}})}this.connection&&(o.canvas.classList.add("focused"),n.push({name:"Changer Transition",run:()=>Object(a.a)(this,void 0,void 0,(function*(){}))}),n.push({name:"Supprimer Transition",run:()=>Object(a.a)(this,void 0,void 0,(function*(){}))})),this.actions=n}unfocus(){if(this.connection){let t;this.connection&&(t=this.connection.canvas,t.classList.remove("focused"))}this.node&&this.node.classList.remove("focused")}updateAlphabet(){this.automaton.alphabet=[],this.automaton.transitions.forEach(t=>{t.symbols.forEach(t=>{this.automaton.alphabet.includes(t)||this.automaton.alphabet.push(t)})})}prompt(t,o,n){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.dialog.promptAsync({title:t,okTitle:"OK",noTitle:"Annuler",fields:[{type:"text",placeholder:o,value:n,required:!0}]});return!!e&&e.fields[0].value}))}};return t.\u0275fac=function(o){return new(o||t)(e["\u0275\u0275directiveInject"](e.Injector),e["\u0275\u0275directiveInject"](u.a))},t.\u0275cmp=e["\u0275\u0275defineComponent"]({type:t,selectors:[["wc-automaton-editor"]],viewQuery:function(t,o){var n;1&t&&e["\u0275\u0275staticViewQuery"](p,!0),2&t&&e["\u0275\u0275queryRefresh"](n=e["\u0275\u0275loadQuery"]())&&(o.container=n.first)},inputs:{state:"state"},decls:6,vars:4,consts:[[1,"automaton-editor-component"],[1,"actions"],[4,"ngFor","ngForOf"],[1,"canvas"],["container",""],[3,"state","stateChange"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,o){1&t&&(e["\u0275\u0275elementStart"](0,"div",0),e["\u0275\u0275elementStart"](1,"div",1),e["\u0275\u0275template"](2,l,3,1,"ng-container",2),e["\u0275\u0275elementEnd"](),e["\u0275\u0275element"](3,"div",3,4),e["\u0275\u0275elementEnd"](),e["\u0275\u0275elementStart"](5,"wc-base",5),e["\u0275\u0275listener"]("stateChange",(function(t){return o.state=t})),e["\u0275\u0275elementEnd"]()),2&t&&(e["\u0275\u0275styleProp"]("height",o.state.height),e["\u0275\u0275advance"](2),e["\u0275\u0275property"]("ngForOf",o.actions),e["\u0275\u0275advance"](3),e["\u0275\u0275property"]("state",o.state))},directives:[h.NgForOf,m.a],styles:['@charset "UTF-8";.automaton-editor-component[_ngcontent-%COMP%]{height:550px;max-height:700px;border:1px solid #ccc;background-color:#ccc;display:flex;position:relative}.automaton-editor-component[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;z-index:100}.automaton-editor-component[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:4px}.automaton-editor-component[_ngcontent-%COMP%]   .canvas[_ngcontent-%COMP%]{flex:1;position:relative;overflow:auto}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .endpoint[_ngcontent-%COMP%]{-webkit-touch-callout:none!important;-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state[_ngcontent-%COMP%]{padding:16px;position:absolute;z-index:4;opacity:.8;cursor:move;background-color:#fff;font-size:18px;border:1px solid #2e6f9a;border-radius:50%;box-shadow:2px 2px 19px #e0e0e0;-o-box-shadow:2px 2px 19px #e0e0e0;-webkit-box-shadow:2px 2px 19px #e0e0e0;-moz-box-shadow:2px 2px 19px #e0e0e0;-moz-border-radius:8px;transition:background-color .25s ease-in}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state.focused[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .automaton-state[_ngcontent-%COMP%]:hover{background-color:#5c96bc;color:#fff}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state.automaton-state--initial[_ngcontent-%COMP%]:before{content:"\u2192";font-size:48px;position:absolute;left:-48px;top:50%;transform:translateY(-50%);color:#000}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state.automaton-state--final[_ngcontent-%COMP%]:after{content:" ";position:absolute;z-index:-1;top:3px;left:3px;right:3px;bottom:3px;border:3px solid #2e6f9a;border-radius:50%}.automaton-editor-component[_ngcontent-%COMP%]   .endpoint[_ngcontent-%COMP%]{position:absolute;bottom:37%;right:-6px;width:1em;height:1em;background-color:orange;cursor:pointer;box-shadow:0 0 2px #000;transition:box-shadow .25s ease-in;border-radius:50%}.automaton-editor-component[_ngcontent-%COMP%]   .endpoint[_ngcontent-%COMP%]:hover{box-shadow:0 0 6px #000}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-endpoint[_ngcontent-%COMP%]{z-index:3}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-endpoint[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{cursor:pointer}.automaton-editor-component[_ngcontent-%COMP%]   .transition[_ngcontent-%COMP%]{transition:background-color .25s ease-in;background-color:#fff;opacity:.8;padding:.3em;border-radius:.5em;border:1px solid #346789;cursor:pointer}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-connector.focused[_ngcontent-%COMP%] + .transition[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .jtk-source-hover[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .jtk-target-hover[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .transition.jtk-hover[_ngcontent-%COMP%]{background-color:#1e8151;color:#fff}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-connector.focused[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:#1e8151!important;stroke-width:2}@media (max-width:600px){.automaton-editor-component[_ngcontent-%COMP%]{margin-left:0;margin-top:10px;width:100%;height:364px}}'],changeDetection:0}),t=Object(a.b)([Object(s.b)(r)],t),t})(),b=(()=>{class t{constructor(){this.customElementComponent=v}}return t.\u0275mod=e["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=e["\u0275\u0275defineInjector"]({factory:function(o){return new(o||t)},imports:[[i.a]]}),t})()}}]);