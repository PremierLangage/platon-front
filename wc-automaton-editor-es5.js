!function(){function t(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,o){if(!t)return;if("string"==typeof t)return n(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return n(t,o)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var o=0,e=new Array(n);o<n;o++)e[o]=t[o];return e}function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function e(t,n){for(var o=0;o<n.length;o++){var e=n[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"p0/3":function(n,a,i){"use strict";i.r(a),i.d(a,"AutomatonEditorModule",(function(){return M}));var r=i("vOrQ"),s=i("Yf6g"),c=i("D57K"),u=i("wgwC"),d=Object(u.d)({type:u.c.form,name:"AutomatonEditor",icon:"assets/images/components/forms/automaton-editor/automaton-editor.svg",selector:"wc-automaton-editor",description:"Permets de saisir un automate \xe0 l'aide d'un \xe9diteur graphique.",fullDescriptionUrl:"assets/docs/components/forms/automaton-editor/automaton-editor.md",schema:{$schema:"http://json-schema.org/draft-07/schema",type:"object",properties:{height:{type:"number",default:400,description:"La hauteur de l'\xe9diteur en px."},automaton:{type:"object",default:{},description:"Automate dessiner."}}}}),m=i("A2ki"),p=i("iVbZ"),l=i("6Jna"),h=i("0S4P"),f=i("4cXV"),g=["container"];function v(t,n){if(1&t&&(r["\u0275\u0275elementContainerStart"](0),r["\u0275\u0275elementStart"](1,"button",6),r["\u0275\u0275listener"]("click",(function(){return n.$implicit.run()})),r["\u0275\u0275text"](2),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementContainerEnd"]()),2&t){var o=n.$implicit;r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate1"](" ",o.name," ")}}var b,x,C="automaton-state--initial",O="automaton-state--final",y=((x=function(){function n(t,e){o(this,n),this.injector=t,this.dialog=e,this.nextId=0,this.actions=[]}var a,i,r;return a=n,(i=[{key:"ngOnInit",value:function(){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.instance=m.jsPlumb.getInstance({Endpoint:["Dot",{radius:2}],Connector:"StateMachine",HoverPaintStyle:{stroke:"#1e8151",strokeWidth:2},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}],["Label",{label:"transition",id:"transition",cssClass:"transition"}]],Container:this.container.nativeElement}),t.next=3,new Promise((function(t){n.instance.bind("ready",(function(){n.instance.registerConnectionType("basic",{anchor:"Continuous",connector:"StateMachine"}),n.instance.bind("click",(function(t){n.focus(void 0,t)})),n.instance.bind("beforeDrop",(function(t){n.createTransition(t)})),m.jsPlumb.on(n.container.nativeElement,"dblclick",(function(t){n.createNode(t.offsetX,t.offsetY)})),t()}))}));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"ngOnDestroy",value:function(){var t;null===(t=this.instance)||void 0===t||t.reset()}},{key:"onChangeState",value:function(){var t=this;this.node=void 0,this.connection=void 0,this.instance.reset(!0),this.instance.getContainer().innerHTML="";try{"string"==typeof this.automaton?this.automaton=Object(p.a)(this.automaton):this.automaton||(this.automaton=Object(p.c)())}catch(o){console.log(o),this.automaton=Object(p.c)()}this.nextId=this.automaton.states.length;var n=this.automaton;n.position=this.automaton.position||{},n.states=this.automaton.states||[],n.acceptingStates=this.automaton.acceptingStates||[],n.initialStates=this.automaton.initialStates||[],n.transitions=this.automaton.transitions||[],this.updateAlphabet(),this.instance.batch((function(){n.states.forEach((function(o){n.position||(n.position={});var e=n.position[o];e?t.createNode(e.x,e.y,o):t.createNode(400*Math.random(),200*Math.random(),o)}))}))}},{key:"createTransition",value:function(t){var n=t.sourceId,o=t.targetId;return!this.automaton.transitions.find((function(t){return t.fromState===n&&t.toState===o}))&&(this.automaton.transitions.push({fromState:n,toState:o,symbols:["$"]}),this.updateAlphabet(),!0)}},{key:"createNode",value:function(t,n,o){var e,a,i=this,r=document.createElement("div"),s=o||"S"+this.nextId++;r.id=s,r.className="automaton-state",r.innerHTML=s+' <div class="endpoint"></div>',r.style.left=t+"px",r.style.top=n+"px",this.automaton.position||(this.automaton.position={}),this.automaton.position[r.id]={x:t,y:n},o?(this.automaton.initialStates.includes(o)&&r.classList.add(C),this.automaton.acceptingStates.includes(o)&&r.classList.add(O)):(0===this.automaton.initialStates.length&&(r.classList.add(C),this.automaton.initialStates.push(s)),this.automaton.states.push(s)),m.jsPlumb.on(r,"click",(function(){i.focus(r)})),null===(e=this.instance)||void 0===e||e.getContainer().appendChild(r),null===(a=this.instance)||void 0===a||a.draggable(r,{drag:function(t){i.automaton.position||(i.automaton.position={}),i.automaton.position[r.id]={x:t.pos[0],y:t.pos[1]}}}),this.instance.makeSource(r,{filter:".endpoint",anchor:"Continuous",connectorStyle:{stroke:"#5c96bc",strokeWidth:2,outlineStroke:"transparent",outlineWidth:4},connectionType:"basic",maxConnections:-1}),this.instance.makeTarget(r,{dropOptions:{hoverClass:"dragHover"},anchor:"Continuous",allowLoopback:!0})}},{key:"focus",value:function(n,o){var e=this;this.unfocus(),this.node=n,this.connection=o;var a=[];if(this.node){this.node.classList.remove("focused"),this.node.classList.add("focused");var i=this.node.classList.contains(C),r=this.node.classList.contains(O);i||a.push({name:"Initial",run:function(){e.node&&(e.node.classList.add(C),e.automaton.initialStates.push(e.node.id),e.focus(e.node))}}),r||a.push({name:"Final",run:function(){e.node&&(e.node.classList.add(O),e.automaton.acceptingStates.includes(e.node.id)||e.automaton.acceptingStates.push(e.node.id),e.focus(e.node))}}),(i||r)&&a.push({name:"Normal",run:function(){e.node&&(e.node.classList.remove(C),e.node.classList.remove(O),e.automaton.acceptingStates=e.automaton.acceptingStates.filter((function(t){var n;return t!==(null===(n=e.node)||void 0===n?void 0:n.id)})),e.focus(e.node))}}),a.push({name:"Renommer",run:function(){return Object(c.a)(e,void 0,void 0,regeneratorRuntime.mark((function n(){var o,e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.node){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,this.prompt("\xc9tat","Entrez un nouveau nom",this.node.id);case 4:!1!==(o=n.sent)&&(o=o.trim(),this.automaton.states.includes(o)?alert("\xc9tat d\xe9j\xe0 pr\xe9sent"):(this.automaton.states=[o].concat(t(this.automaton.states.filter((function(t){var n;return t!==(null===(n=e.node)||void 0===n?void 0:n.id)})))),this.automaton.acceptingStates=this.automaton.acceptingStates.map((function(t){var n;return t===(null===(n=e.node)||void 0===n?void 0:n.id)?o:t})),this.automaton.initialStates=this.automaton.initialStates.map((function(t){var n;return t===(null===(n=e.node)||void 0===n?void 0:n.id)?o:t})),this.automaton.transitions.forEach((function(t){var n,a;t.fromState===(null===(n=e.node)||void 0===n?void 0:n.id)&&(t.fromState=o),t.toState===(null===(a=e.node)||void 0===a?void 0:a.id)&&(t.toState=o)})),this.node.innerHTML=this.node.id=o)),this.updateAlphabet();case 6:case"end":return n.stop()}}),n,this)})))}}),a.push({name:"Supprimer",run:function(){e.automaton.initialStates=e.automaton.initialStates.filter((function(t){var n;return t!==(null===(n=e.node)||void 0===n?void 0:n.id)})),e.automaton.acceptingStates=e.automaton.acceptingStates.filter((function(t){var n;return t!==(null===(n=e.node)||void 0===n?void 0:n.id)})),e.automaton.states=e.automaton.states.filter((function(t){var n;return t!==(null===(n=e.node)||void 0===n?void 0:n.id)})),e.automaton.transitions=e.automaton.transitions.filter((function(t){var n,o;return t.fromState!==(null===(n=e.node)||void 0===n?void 0:n.id)&&t.toState!==(null===(o=e.node)||void 0===o?void 0:o.id)})),e.automaton.position||(e.automaton.position={}),e.node&&(delete e.automaton.position[e.node.id],e.instance.remove(e.node),e.focus(),e.updateAlphabet())}})}this.connection&&(o.canvas.classList.add("focused"),a.push({name:"Changer Transition",run:function(){return Object(c.a)(e,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))}}),a.push({name:"Supprimer Transition",run:function(){return Object(c.a)(e,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))}})),this.actions=a}},{key:"unfocus",value:function(){this.connection&&this.connection&&this.connection.canvas.classList.remove("focused"),this.node&&this.node.classList.remove("focused")}},{key:"updateAlphabet",value:function(){var t=this;this.automaton.alphabet=[],this.automaton.transitions.forEach((function(n){n.symbols.forEach((function(n){t.automaton.alphabet.includes(n)||t.automaton.alphabet.push(n)}))}))}},{key:"prompt",value:function(t,n,o){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dialog.promptAsync({title:t,okTitle:"OK",noTitle:"Annuler",fields:[{type:"text",placeholder:n,value:o,required:!0}]});case 2:return a=e.sent,e.abrupt("return",!!a&&a.fields[0].value);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"automaton",set:function(t){this.state.automaton=t},get:function(){return this.state.automaton}}])&&e(a.prototype,i),r&&e(a,r),n}()).\u0275fac=function(t){return new(t||x)(r["\u0275\u0275directiveInject"](r.Injector),r["\u0275\u0275directiveInject"](l.a))},x.\u0275cmp=r["\u0275\u0275defineComponent"]({type:x,selectors:[["wc-automaton-editor"]],viewQuery:function(t,n){var o;1&t&&r["\u0275\u0275staticViewQuery"](g,!0),2&t&&r["\u0275\u0275queryRefresh"](o=r["\u0275\u0275loadQuery"]())&&(n.container=o.first)},inputs:{state:"state"},decls:6,vars:4,consts:[[1,"automaton-editor-component"],[1,"actions"],[4,"ngFor","ngForOf"],[1,"canvas"],["container",""],[3,"state","stateChange"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){1&t&&(r["\u0275\u0275elementStart"](0,"div",0),r["\u0275\u0275elementStart"](1,"div",1),r["\u0275\u0275template"](2,v,3,1,"ng-container",2),r["\u0275\u0275elementEnd"](),r["\u0275\u0275element"](3,"div",3,4),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](5,"wc-base",5),r["\u0275\u0275listener"]("stateChange",(function(t){return n.state=t})),r["\u0275\u0275elementEnd"]()),2&t&&(r["\u0275\u0275styleProp"]("height",n.state.height),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngForOf",n.actions),r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("state",n.state))},directives:[h.NgForOf,f.a],styles:['@charset "UTF-8";.automaton-editor-component[_ngcontent-%COMP%]{height:550px;max-height:700px;border:1px solid #ccc;background-color:#ccc;display:flex;position:relative}.automaton-editor-component[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;z-index:100}.automaton-editor-component[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:4px}.automaton-editor-component[_ngcontent-%COMP%]   .canvas[_ngcontent-%COMP%]{flex:1;position:relative;overflow:auto}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .endpoint[_ngcontent-%COMP%]{-webkit-touch-callout:none!important;-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state[_ngcontent-%COMP%]{padding:16px;position:absolute;z-index:4;opacity:.8;cursor:move;background-color:#fff;font-size:18px;border:1px solid #2e6f9a;border-radius:50%;box-shadow:2px 2px 19px #e0e0e0;-o-box-shadow:2px 2px 19px #e0e0e0;-webkit-box-shadow:2px 2px 19px #e0e0e0;-moz-box-shadow:2px 2px 19px #e0e0e0;-moz-border-radius:8px;transition:background-color .25s ease-in}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state.focused[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .automaton-state[_ngcontent-%COMP%]:hover{background-color:#5c96bc;color:#fff}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state.automaton-state--initial[_ngcontent-%COMP%]:before{content:"\u2192";font-size:48px;position:absolute;left:-48px;top:50%;transform:translateY(-50%);color:#000}.automaton-editor-component[_ngcontent-%COMP%]   .automaton-state.automaton-state--final[_ngcontent-%COMP%]:after{content:" ";position:absolute;z-index:-1;top:3px;left:3px;right:3px;bottom:3px;border:3px solid #2e6f9a;border-radius:50%}.automaton-editor-component[_ngcontent-%COMP%]   .endpoint[_ngcontent-%COMP%]{position:absolute;bottom:37%;right:-6px;width:1em;height:1em;background-color:orange;cursor:pointer;box-shadow:0 0 2px #000;transition:box-shadow .25s ease-in;border-radius:50%}.automaton-editor-component[_ngcontent-%COMP%]   .endpoint[_ngcontent-%COMP%]:hover{box-shadow:0 0 6px #000}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-endpoint[_ngcontent-%COMP%]{z-index:3}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-endpoint[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{cursor:pointer}.automaton-editor-component[_ngcontent-%COMP%]   .transition[_ngcontent-%COMP%]{transition:background-color .25s ease-in;background-color:#fff;opacity:.8;padding:.3em;border-radius:.5em;border:1px solid #346789;cursor:pointer}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-connector.focused[_ngcontent-%COMP%] + .transition[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .jtk-source-hover[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .jtk-target-hover[_ngcontent-%COMP%], .automaton-editor-component[_ngcontent-%COMP%]   .transition.jtk-hover[_ngcontent-%COMP%]{background-color:#1e8151;color:#fff}.automaton-editor-component[_ngcontent-%COMP%]   .jtk-connector.focused[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:#1e8151!important;stroke-width:2}@media (max-width:600px){.automaton-editor-component[_ngcontent-%COMP%]{margin-left:0;margin-top:10px;width:100%;height:364px}}'],changeDetection:0}),x=Object(c.b)([Object(u.b)(d)],x)),M=((b=function t(){o(this,t),this.customElementComponent=y}).\u0275mod=r["\u0275\u0275defineNgModule"]({type:b}),b.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||b)},imports:[[s.a]]}),b)}}])}();